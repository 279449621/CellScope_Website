

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analysis of Disease-Control Cell Atlas &mdash; CellScope 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=2709fde1"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API" href="API.html" />
    <link rel="prev" title="Visualization on Marker Gene" href="Visualization%20on%20Marker%20Gene.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CellScope
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Manifold%20Fitting%20and%20Clustering.html">Manifold Fitting and Clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="Tree%20Structure%20Construction.html">Tree Structure Construction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Gene%20Analysis%20Through%20Different%20Layer.html">Gene Analysis Through Different Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="Visualization%20on%20Marker%20Gene.html">Visualization on Marker Gene</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Analysis of Disease-Control Cell Atlas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#run-cellscope-on-the-dataset">Run CellScope on the Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cellscope-has-the-ability-to-identify-cell-types">CellScope has the ability to identify cell types.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualization-on-this-system">Visualization on This System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-identification-of-marker-genes-for-covid-19-in-the-system">The identification of marker genes for COVID-19 in the system.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tree-structured-of-pbmc">Tree Structured of PBMC</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="Contributions%20and%20Feature%20Requests.html">Contributions and Feature Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="References.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CellScope</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="Tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Analysis of Disease-Control Cell Atlas</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Analysis of Disease-Control Cell Atlas.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="analysis-of-disease-control-cell-atlas">
<h1>Analysis of Disease-Control Cell Atlas<a class="headerlink" href="#analysis-of-disease-control-cell-atlas" title="Link to this heading"></a></h1>
<p>The dataset contains 49,139 cells from the PBMC and comes from individuals with different severities of COVID-19. Specifically, the dataset includes three disease severity levels: COVID-19 Severe, COVID-19 Moderate, and Healthy.
For more details, refer to the <a class="reference external" href="https://cellxgene.cziscience.com/e/59b69042-47c2-47fd-ad03-d21beb99818f.cxg/">description</a>.
It is available for free download in <strong>h5ad</strong> format from the <strong>CELLxGENE</strong> website via this link: <a class="reference external" href="https://datasets.cellxgene.cziscience.com/fbe23743-b3b5-4e2c-9bb2-95ee14d36783.h5ad">Download Link</a>.</p>
<section id="run-cellscope-on-the-dataset">
<h2>Run CellScope on the Dataset<a class="headerlink" href="#run-cellscope-on-the-dataset" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">anndata</span>
<span class="kn">import</span> <span class="nn">CellScope</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">issparse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://datasets.cellxgene.cziscience.com/fbe23743-b3b5-4e2c-9bb2-95ee14d36783.h5ad&quot;</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;COVID-19.h5ad&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="n">adata</span> <span class="o">=</span> <span class="n">anndata</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s2">&quot;COVID-19.h5ad&quot;</span><span class="p">)</span>
<span class="n">fea_raw</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">X</span>
<span class="n">cell_types</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cell_types</span><span class="p">)</span>
<span class="n">fea_raw</span><span class="p">,</span><span class="n">fea_log</span><span class="p">,</span><span class="n">fea</span> <span class="o">=</span> <span class="n">CellScope</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">Normalization</span><span class="p">(</span><span class="n">fea_raw</span><span class="p">)</span>
<span class="n">fea_Fitting_1</span><span class="p">,</span> <span class="n">Signal_Space</span><span class="p">,</span> <span class="n">Center_index</span> <span class="o">=</span> <span class="n">CellScope</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">Manifold_Fitting_1</span><span class="p">(</span><span class="n">fea</span><span class="p">)</span>
<span class="k">if</span> <span class="n">issparse</span><span class="p">(</span><span class="n">fea_Fitting_1</span><span class="p">):</span>
    <span class="n">fea_Fitting_1</span> <span class="o">=</span> <span class="n">fea_Fitting_1</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">fea_Fitting_2</span><span class="p">,</span> <span class="n">fitting_index</span><span class="p">,</span> <span class="n">index_after_outlier_removal</span> <span class="o">=</span> <span class="n">CellScope</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">Manifold_Fitting_2</span><span class="p">(</span><span class="n">fea_Fitting_1</span><span class="p">)</span>
<span class="n">T_all_1</span> <span class="o">=</span> <span class="n">CellScope</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">GraphCluster</span><span class="p">(</span><span class="n">fea_Fitting_1</span><span class="p">)</span>
<span class="n">T_all_2</span> <span class="o">=</span> <span class="n">CellScope</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">GraphCluster</span><span class="p">(</span><span class="n">fea_Fitting_2</span><span class="p">)</span>
<span class="n">Y_1</span> <span class="o">=</span> <span class="n">CellScope</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">Visualization</span><span class="p">(</span><span class="n">fea_Fitting_1</span><span class="p">)</span>
<span class="n">Y_2</span> <span class="o">=</span> <span class="n">CellScope</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">Visualization</span><span class="p">(</span><span class="n">fea_Fitting_2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="cellscope-has-the-ability-to-identify-cell-types">
<h2>CellScope has the ability to identify cell types.<a class="headerlink" href="#cellscope-has-the-ability-to-identify-cell-types" title="Link to this heading"></a></h2>
<p>CellScope successfully isolated a cell system primarily composed of <strong>classical monocytes, conventional dendritic cells, and non-classical monocytes</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">label_3</span> <span class="o">=</span> <span class="n">T_all_2</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">index_label_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">label_3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">label_subset</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="n">index_label_1</span><span class="p">]</span>
<span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">label_subset</span><span class="p">)</span>
<span class="n">total_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">label_subset</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">unique_labels</span><span class="p">:</span>
    <span class="n">count_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">label</span><span class="o">==</span><span class="n">ii</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">label_subset</span> <span class="o">==</span> <span class="n">ii</span><span class="p">)</span>
    <span class="n">proportion</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="n">count_all</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Category: </span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">, Sample Count: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">, Proportion: </span><span class="si">{</span><span class="n">proportion</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Category</strong>: activated CD4-positive, alpha-beta T cell, human
- <strong>Sample Count</strong>: 2
- <strong>Proportion</strong>: 0.0021</p></li>
<li><p><strong>Category</strong>: central memory CD4-positive, alpha-beta T cell
- <strong>Sample Count</strong>: 2
- <strong>Proportion</strong>: 0.0006</p></li>
<li><p><strong>Category</strong>: classical monocyte
- <strong>Sample Count</strong>: 7874
- <strong>Proportion</strong>: 0.9948</p></li>
<li><p><strong>Category</strong>: conventional dendritic cell
- <strong>Sample Count</strong>: 2955
- <strong>Proportion</strong>: 0.9963</p></li>
<li><p><strong>Category</strong>: effector memory CD8-positive, alpha-beta T cell
- <strong>Sample Count</strong>: 2
- <strong>Proportion</strong>: 0.0006</p></li>
<li><p><strong>Category</strong>: erythrocyte
- <strong>Sample Count</strong>: 46
- <strong>Proportion</strong>: 0.1565</p></li>
<li><p><strong>Category</strong>: hematopoietic stem cell
- <strong>Sample Count</strong>: 27
- <strong>Proportion</strong>: 0.0384</p></li>
<li><p><strong>Category</strong>: immature neutrophil
- <strong>Sample Count</strong>: 39
- <strong>Proportion</strong>: 0.9750</p></li>
<li><p><strong>Category</strong>: lymphocyte
- <strong>Sample Count</strong>: 3
- <strong>Proportion</strong>: 0.0082</p></li>
<li><p><strong>Category</strong>: naive thymus-derived CD4-positive, alpha-beta T cell
- <strong>Sample Count</strong>: 2
- <strong>Proportion</strong>: 0.0004</p></li>
<li><p><strong>Category</strong>: natural killer cell
- <strong>Sample Count</strong>: 1
- <strong>Proportion</strong>: 0.0002</p></li>
<li><p><strong>Category</strong>: neutrophil
- <strong>Sample Count</strong>: 6
- <strong>Proportion</strong>: 1.0000</p></li>
<li><p><strong>Category</strong>: non-classical monocyte
- <strong>Sample Count</strong>: 3358
- <strong>Proportion</strong>: 0.9997</p></li>
<li><p><strong>Category</strong>: plasmablast
- <strong>Sample Count</strong>: 162
- <strong>Proportion</strong>: 0.1141</p></li>
<li><p><strong>Category</strong>: plasmacytoid dendritic cell, human
- <strong>Sample Count</strong>: 30
- <strong>Proportion</strong>: 0.0232</p></li>
<li><p><strong>Category</strong>: platelet
- <strong>Sample Count</strong>: 101
- <strong>Proportion</strong>: 0.0232</p></li>
<li><p><strong>Category</strong>: transitional stage B cell
- <strong>Sample Count</strong>: 3
- <strong>Proportion</strong>: 0.0042</p></li>
</ul>
</section>
<section id="visualization-on-this-system">
<h2>Visualization on This System<a class="headerlink" href="#visualization-on-this-system" title="Link to this heading"></a></h2>
<p>The visualization results from CellScope on the system not only achieved <strong>differentiation</strong> at the <strong>cellular category level</strong> (left, middle, right), but also showed clear distinctions across <strong>different disease states</strong> (top, middle, bottom).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">def</span> <span class="nf">plot_encoded_labels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
    <span class="n">encoded_labels</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
    <span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">encoded_labels</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
    <span class="n">handles</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">scatter</span><span class="o">.</span><span class="n">cmap</span><span class="p">(</span><span class="n">scatter</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="n">label</span><span class="p">])[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">unique_labels</span>
    <span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Classes&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;UMAP 1&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;UMAP 2&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scatter</span>
<span class="n">Label_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;classical monocyte&#39;</span><span class="p">,</span><span class="s1">&#39;conventional dendritic cell&#39;</span><span class="p">,</span><span class="s1">&#39;non-classical monocyte&#39;</span><span class="p">]</span>
<span class="n">index_all</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">label_name</span> <span class="ow">in</span> <span class="n">Label_name</span><span class="p">:</span>
    <span class="n">index_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">label</span><span class="o">==</span><span class="n">label_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">index_all</span><span class="p">)</span>
<span class="n">index_label_1_inter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">index_label_1</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">plot_encoded_labels</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">index_label_1_inter</span><span class="p">,</span> <span class="n">Y_2</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Cell Type&#39;</span><span class="p">)</span>
<span class="n">label_disease</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;COVID-19 Condition&#39;</span><span class="p">])</span>
<span class="n">plot_encoded_labels</span><span class="p">(</span><span class="n">label_disease</span><span class="p">,</span> <span class="n">index_label_1_inter</span><span class="p">,</span> <span class="n">Y_2</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Disease Label&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="Visualization on COVID-19" class="align-center" src="_images/Visualization_COVID.png" />
</section>
<section id="the-identification-of-marker-genes-for-covid-19-in-the-system">
<h2>The identification of marker genes for COVID-19 in the system.<a class="headerlink" href="#the-identification-of-marker-genes-for-covid-19-in-the-system" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">issparse</span>
<span class="n">Cluster_Moderate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">label_disease</span> <span class="o">==</span> <span class="s1">&#39;COVID-19 Moderate&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Cluster_Severe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">label_disease</span> <span class="o">==</span> <span class="s1">&#39;COVID-19 Severe&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Cluster_COVID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Cluster_Moderate</span><span class="p">,</span><span class="n">Cluster_Severe</span><span class="p">))</span>
<span class="n">Cluster_Healthy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">label_disease</span> <span class="o">==</span> <span class="s1">&#39;Healthy&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">Cluster_COVID_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">index_label_1</span><span class="p">,</span><span class="n">Cluster_COVID</span><span class="p">)</span>
<span class="n">Cluster_Severe_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">index_label_1</span><span class="p">,</span><span class="n">Cluster_Severe</span><span class="p">)</span>
<span class="n">Cluster_Moderate_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">index_label_1</span><span class="p">,</span><span class="n">Cluster_Moderate</span><span class="p">)</span>
<span class="n">Cluster_Healthy_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">index_label_1</span><span class="p">,</span><span class="n">Cluster_Healthy</span><span class="p">)</span>

<span class="n">Gene_Name</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;feature_name&#39;</span><span class="p">]</span>
<span class="n">marker_gene_indices</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">CellScope</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">FindMarker</span><span class="p">(</span><span class="n">fea_log</span><span class="p">,</span> <span class="n">Cluster_COVID_index</span><span class="p">,</span> <span class="n">Cluster_Healthy_index</span><span class="p">,</span> <span class="n">selected_number</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">selected_method</span> <span class="o">=</span> <span class="s1">&#39;diff pct&#39;</span><span class="p">)</span>
<span class="n">marker_gene_name</span> <span class="o">=</span> <span class="n">Gene_Name</span><span class="p">[</span><span class="n">marker_gene_indices</span><span class="p">]</span>

<span class="n">celltype_name</span> <span class="o">=</span> <span class="n">label_disease</span><span class="p">[</span><span class="n">index_label_1</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">marker_gene_indices</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">if</span> <span class="n">issparse</span><span class="p">(</span><span class="n">fea_log</span><span class="p">):</span>
    <span class="n">fea_log</span> <span class="o">=</span> <span class="n">fea_log</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">gene_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">marker_gene_indices</span><span class="p">):</span>
    <span class="n">gene_expression</span> <span class="o">=</span> <span class="n">fea_log</span><span class="p">[</span><span class="n">index_label_1</span><span class="p">,</span> <span class="n">gene_idx</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Cell Type&#39;</span><span class="p">:</span> <span class="n">celltype_name</span><span class="p">,</span> <span class="s1">&#39;Gene Expression&#39;</span><span class="p">:</span> <span class="n">gene_expression</span><span class="p">})</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Gene Expression&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Cell Type&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Cell Type&#39;</span><span class="p">,</span>
        <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;Set2&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">marker_gene_name</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cluster Name&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

    <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">]:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">spine</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="Marker Gene 1" class="align-center" src="_images/Marker_Gene_1_COVID.png" />
<p>Among the 10 marker genes identified by CellScope, <em>HLA-DQA2</em> and <em>HLA-DRB5</em> show significantly higher expression in both <strong>healthy individuals</strong> and the <strong>COVID-19 moderate group</strong>, while the <em>CLU</em> gene is highly expressed in the <strong>COVID-19 severe group</strong>. The other seven genes exhibit significantly higher expression in the <strong>COVID-19 group</strong> and lower expression in <strong>healthy individuals</strong>.</p>
<p>In addition, we plotted the violin plots of these 10 marker genes outside the system and found that the expression differences of <em>HLA-DQA2</em>, <em>CLU</em>, and <em>HLA-DRB5</em> were not significant, indicating that the marker role of these genes for COVID infection is valid only within the system.</p>
<img alt="Marker Gene 2" class="align-center" src="_images/Marker_Gene_2_COVID.png" />
</section>
<section id="tree-structured-of-pbmc">
<h2>Tree Structured of PBMC<a class="headerlink" href="#tree-structured-of-pbmc" title="Link to this heading"></a></h2>
<p>CellScope can generate a hierarchical visualization result plot from two labels, the first of which is based on the hierarchical clustering results of CellScope.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">issparse</span>
<span class="k">if</span> <span class="n">issparse</span><span class="p">(</span><span class="n">fea_Fitting_1</span><span class="p">):</span>
    <span class="n">fea_Fitting_1</span> <span class="o">=</span> <span class="n">fea_Fitting_1</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">Y_initial</span><span class="p">,</span> <span class="n">label_step0</span><span class="p">,</span> <span class="n">Y_1</span><span class="p">,</span> <span class="n">Title_1</span><span class="p">,</span> <span class="n">Y_all</span><span class="p">,</span> <span class="n">Title_all</span><span class="p">,</span> <span class="n">index_1</span><span class="p">,</span> <span class="n">index_all</span><span class="p">,</span> <span class="n">step0</span><span class="p">,</span> <span class="n">step1</span> <span class="o">=</span> <span class="n">CellScope</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">generate_tree_structured</span><span class="p">(</span><span class="n">fea_Fitting_2</span><span class="p">,</span> <span class="n">T_all_2</span><span class="p">,</span> <span class="n">step0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">step1</span> <span class="o">=</span> <span class="mi">17</span><span class="p">)</span>
<span class="n">CellScope</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">visualize_tree_structured</span><span class="p">(</span><span class="n">Y_initial</span><span class="p">,</span> <span class="n">label_step0</span><span class="p">,</span> <span class="n">Y_1</span><span class="p">,</span> <span class="n">Title_1</span><span class="p">,</span> <span class="n">Y_all</span><span class="p">,</span> <span class="n">Title_all</span><span class="p">,</span> <span class="n">index_1</span><span class="p">,</span> <span class="n">index_all</span><span class="p">,</span> <span class="n">step0</span><span class="p">,</span> <span class="n">step1</span><span class="p">,</span> <span class="n">T_all_2</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s1">&#39;Res&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="Tree Structured V1" class="align-center" src="_images/Tree_Structured_COVID_1.png" />
<p>CellScope can also color the visualization results based on the severity of COVID-19, with purple representing COVID-19 severe, green representing COVID-19 moderate, and blue representing healthy. Cluster0221 and Cluster0222 are derived from the monocyte dendritic cell system, but Cluster0221 almost exclusively contains COVID-19 patients, while Cluster0222 almost exclusively contains healthy individuals. This indicates that, in this case, the gene expression differences between the diseased and healthy populations are more significant than the expression differences between cell types, which is why CellScope was able to identify this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">label_disease</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;COVID-19 Condition&#39;</span><span class="p">])</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">label_numr</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">label_disease</span><span class="p">)</span>
<span class="n">celltype</span> <span class="o">=</span> <span class="n">label_numr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">unique_celltypes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">celltype</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_celltypes</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">color_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_celltypes</span><span class="p">)}</span>
<span class="n">colors_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">color_map</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">celltype</span><span class="p">])</span>
<span class="n">total_plots</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y_1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y_all</span><span class="p">)</span>
<span class="n">n_cols</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_plots</span> <span class="o">+</span> <span class="n">n_cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">n_cols</span>
<span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Y_initial</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Y_initial</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors_array</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Initial&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y_1</span><span class="p">)):</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">Y_1</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">n_cols</span><span class="p">,</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_cols</span><span class="p">]</span>
    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">point_size</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">n_points</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">(</span><span class="mi">5</span> <span class="k">if</span> <span class="n">n_points</span> <span class="o">&lt;</span> <span class="mi">500</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors_array</span><span class="p">[</span><span class="n">index_1</span><span class="p">[</span><span class="n">ii</span><span class="p">]],</span> <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">Title_1</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y_all</span><span class="p">)):</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">Y_all</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y_1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">n_cols</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y_1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_cols</span><span class="p">]</span>
    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">point_size</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">n_points</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">(</span><span class="mi">5</span> <span class="k">if</span> <span class="n">n_points</span> <span class="o">&lt;</span> <span class="mi">500</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors_array</span><span class="p">[</span><span class="n">index_all</span><span class="p">[</span><span class="n">ii</span><span class="p">]],</span> <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">Title_all</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">total_plots</span><span class="p">:]:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="Tree Structured V2" class="align-center" src="_images/Tree_Structured_COVID_2.png" />
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Visualization%20on%20Marker%20Gene.html" class="btn btn-neutral float-left" title="Visualization on Marker Gene" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="API.html" class="btn btn-neutral float-right" title="API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Yao Group.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>